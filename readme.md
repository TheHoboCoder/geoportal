# Описание
## Введение

Данный проект - веб-ГИС на базе фреймворка GeoDjango, которая предоставляет
платформу для установки и работы геомодулей. Главной целью проекта
является упрощение публикации алгоритмов по обработке пространственных данных.

Стек проекта:

*бэкенд*:
- GeoDjango
- PostgreSQL+PostGIS

*фронтенд*:
- OpenLayers
- *Vue.js* (в процессе перехода, пока jquery)


## Функционал

Административная панель django позволяет создателям модулей и администраторам сайта загружать и удалять модули, а также работать со связанными с ними данными: слоями и пространственными данными.

Главная страница сайта представляет собой интерактивную карту, на которой можно
выбрать модуль из списка. После загрузки модуля отображается список его слоев.

## Установка

### bash

На настоящий момент протестирована установка на Ubuntu 22.04 и на Debian 5.10

Установка на Ubuntu:

```
sudo apt-get update && sudo apt-get install git
git clone https://github.com/TheHoboCoder/geoportal.git
cd geoportal
chmod u+x deploy.sh
sudo ./deploy.sh
```

Установка на Debian:

```
su -
apt-get update && apt-get install git
git clone https://github.com/TheHoboCoder/geoportal.git
cd geoportal
chmod u+x deploy.sh
./deploy.sh
```

Для сайта будет создан аккаунт администратора admin с паролем *changepassword*:

Доступ к административной панели: <хост>/admin/

Выбор модулей: <хост>/select_module/

### docker

# Разработчикам модулей

## Организация кода

Директории geoportal_core и geoportal содержат основной код проекта.
Любые классы и функции, опредленные в этих директориях, предназначены только для 
внутреннего использования. Модуль не должен содержать импортов из них.

Директория common предоставляет API для работы модуля и служит связующим звеном между модулем и геопорталом. 

## Сценарии использования

Модуль поддерживает два основных сценария использования, которые могут сочетаться:

- "пакетная обработка" - периодическое выполнение заданий в фоновом режиме с последующим сохранением пространственных данных в БД, например, обработка спутниковых снимков.

- выполнение пространственных расчетов по запросу пользователя, 
полученные результаты сразу отображаются на карте, но не сохраняются. 

## Структура данных

Классы сущностей определены в common\models.py

### Area

*Area* - Именнованая прямоугольная область на карте, к которой могут быть привязаны слои и пространственные объекты. Служит для более удобной навигации 
по карте и для организации геоданных, некий аналог папки. Например, можно задать список районов, в которых работает модуль.

Модуль должен содержать как минимум одну область.
По умолчанию никак не проверяется, что привязанный к области пространственный объект действительно находится внутри нее.

Представлен классом AreaPO.

### Layer

*Layer* - слой с векторными или растровыми геоданными. Слой может быть привязан к конкретной
области, либо быть глобальным, то есть быть доступным во всех областях. 

Представлен классом LayerPO.

### VectorFeature

Векторный пространственный объект. Содержит данные в виде набора атрибутов, метку времени, а также список пространственных объектов geos: https://docs.djangoproject.com/en/4.2/ref/contrib/gis/geos/. (Рекомендуется хранить не коллекцию, а конкрентный пространственный объект: Point, LineString, Polygon.)

Представлен классом VectorFeaturePO.

## Структура проекта

## Пример модуля

В папке sample_module находится пример модуля.

Модуль обязательно должен содержать module_config с описанием конфигурации.
В этом файле должны быть определены переменные COMMANDS типа CommandList, и SCHEMA типа Schema.

## Описание команд

Для создания команды необходимо определить сериализатор с описанием входных данных 
для команды и создать класс команды, наследующий от CommandView. 
Затем добавить команду в COMMANDS.

Алгоритм работы:
- сериализатор используется для отрисовки формы для команды на сайте
- при отправке формы на сервере происходит валидация данных с помощью сериализатора
- проверенные данные передаются в обработчик команды
- обработчик должен вернуть CommandResponse
- CommandResponse отрисовывается на карте

### Создание сериализатора для команды

По соглашению Django сериализаторы определяются в файле serializers.py.
Сериализатор описывает данные, а также алгоритмы их валидации.
Более подробно про поля сериализатора и валидацию можно почитать здесь:
https://www.django-rest-framework.org/api-guide/serializers/

### Создание сериализатора для команды

Так как команда является представлением, то ее можно определять в файле views.py
Команды должны наследовать класс CommandResponse. В нем нужно определить handler, 
который принимает словарь с данными и возвращает CommandResponse. (см. common/commands/CommandResponse)








